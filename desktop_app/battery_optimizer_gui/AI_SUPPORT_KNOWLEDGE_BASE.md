# Battery Optimizer AI Support Knowledge Base

## 📋 システム概要

Battery Optimizerは日本の電力市場（JEPX、EPRX1、EPRX3）における蓄電池の最適運用を計算するシステムです。

### アプリケーション構成
- **デスクトップ版**: PyQt6ベースのネイティブアプリケーション（推奨）
- **Web版**: Streamlitベースのブラウザアプリケーション

## 🚀 よくある質問とトラブルシューティング

### Q1: アプリケーションが起動しない
**症状**: ダブルクリックしてもアプリが開かない

**解決手順**:
1. **ターミナルから起動確認**:
   ```bash
   cd desktop_app/battery_optimizer_gui
   python main.py
   ```

2. **CBCソルバー確認**:
   ```bash
   python setup.py
   ```

3. **依存関係の再インストール**:
   ```bash
   pip install -r requirements.txt
   ```

### Q2: CBCソルバーエラー
**症状**: "PULP_CBC_CMD: Not Available" エラー

**解決方法**:
1. **自動修復実行**:
   ```bash
   python setup.py
   ```

2. **Homebrewでのインストール（macOS）**:
   ```bash
   brew install cbc
   ```

3. **手動権限設定**:
   ```bash
   chmod +x .venv/lib/python*/site-packages/pulp/solverdir/cbc/*/cbc
   ```

### Q3: 最適化が失敗する・遅い
**症状**: 計算が途中で止まる、時間がかかりすぎる

**解決方法**:
1. **パフォーマンスモードを高速に変更**:
   - GUI: 「エンジンバージョン」→「V1 (高速モード)」選択

2. **予測対象スロット数を削減**:
   - 168 → 48-96に設定変更

3. **データサイズを確認**:
   - 10,000スロット超の場合は分割処理を推奨

### Q4: 日付選択がうまくできない
**症状**: カレンダーから選択したい

**機能**: 
- 期間指定モードでカレンダーボタン（📅）をクリック
- カレンダーダイアログから直感的に日付選択可能

### Q5: グラフの文字が小さい/読みにくい
**対応済み**: v2.0で改善
- 時間別収益分布の数字: フォントサイズ6に調整
- 日付表示: 2023→23の短縮形式
- 全体的なフォント最適化

## 📊 データ仕様

### 必須CSVフォーマット
```csv
date,slot,JEPX_prediction,JEPX_actual,EPRX1_prediction,EPRX1_actual,EPRX3_prediction,EPRX3_actual,imbalance
2024-01-01,1,10.5,10.8,15.2,15.0,20.1,19.8,12.3
```

### データ品質チェックポイント
1. **日付形式**: YYYY-MM-DD（ISO形式必須）
2. **スロット**: 1-48の連続した整数
3. **価格データ**: 負の値も許可（価格がマイナスの場合）
4. **欠損値**: 空白やNaNがないことを確認

## ⚙️ パラメータ設定ガイド

### 基本パラメータ
- **バッテリー出力 (kW)**: 充放電の最大レート
- **バッテリー容量 (kWh)**: 蓄電可能な総エネルギー量
- **損失率 (%)**: 充放電時のエネルギー損失
- **初期残量 (kWh)**: 最適化開始時のバッテリー残量

### 推奨設定値
| 項目 | 小規模 | 中規模 | 大規模 |
|------|--------|--------|--------|
| 出力 | 500kW | 1000kW | 5000kW |
| 容量 | 2000kWh | 4000kWh | 20000kWh |
| 損失率 | 5% | 5% | 3% |

### EPRX1設定（高度）
- **ブロックサイズ**: 通常4スロット（2時間）
- **クールダウン**: 通常4スロット
- **1日最大スロット数**: 通常6スロット

## 🎯 パフォーマンス最適化

### モード選択指針
1. **高速モード (V1)**: 
   - 用途: 日常的な最適化業務
   - 制約: EPRX1制約なし
   - 速度: 最高速（推奨）

2. **標準モード (V2-basic)**:
   - 用途: EPRX1も考慮したい場合
   - 制約: 簡易EPRX1制約
   - 速度: 中程度

3. **完全モード (V2-full)**:
   - 用途: Streamlit版との完全一致が必要
   - 制約: 全制約条件
   - 速度: 最も詳細だが時間要

### データサイズ別推奨設定
| データサイズ | 推奨モード | 予測スロット数 | 想定処理時間 |
|--------------|------------|----------------|--------------|
| ~1,000スロット | 高速 | 48 | 5-10秒 |
| ~5,000スロット | 高速 | 48-96 | 30-60秒 |
| ~10,000スロット | 高速 | 48 | 1-2分 |
| 10,000スロット超 | 高速 | 48 | データ分割推奨 |

## 📈 結果の読み方

### アクション種別
- **charge**: 市場から充電（JEPX安い時間）
- **discharge**: 市場へ放電（JEPX高い時間）
- **eprx1**: 一次調整力でブロック収益
- **eprx3**: 三次調整力で基本収益+インバランス調整
- **idle**: 待機状態

### 収益構造
1. **JEPX収益**: 充放電による売買益
2. **EPRX1収益**: 調整力提供による容量収益
3. **EPRX3収益**: 調整力基本料金＋インバランス収益
4. **コスト**: 託送料金、再エネ賦課金、バッテリー損失

### グラフの見方
- **時間別収益分布**: どの時間帯が収益性が高いか
- **市場別収益貢献**: JEPX vs EPRX1 vs EPRX3の貢献度
- **アクション分布**: どの運用パターンが多いか
- **日別収益推移**: 期間全体の収益トレンド

## 🔧 システム要件・制限事項

### 動作環境
- **OS**: macOS 10.14+、Windows 10+、Linux
- **Python**: 3.8以上
- **メモリ**: 4GB以上（大規模データは8GB推奨）
- **ストレージ**: 1GB以上の空き容量

### 制限事項
- **最大データサイズ**: 100,000スロット程度（メモリ依存）
- **並行処理**: 単一バッテリーサイトのみ
- **市場対応**: 日本の電力市場のみ

## 📞 エラーコード・ログ解釈

### よくあるエラーメッセージ
1. **"No solution found"**: 
   - 原因: 制約条件が厳しすぎる
   - 対策: パラメータを緩和、データを確認

2. **"Optimization failed"**:
   - 原因: ソルバーエラーまたはデータ問題
   - 対策: ログを確認、CBCソルバー再インストール

3. **"Invalid CSV format"**:
   - 原因: CSVの列が不足または形式不正
   - 対策: テンプレートと比較、データクリーニング

### ログの読み方
- **INFO**: 正常な処理状況
- **WARNING**: 注意が必要だが処理は継続
- **ERROR**: 処理が中断される問題
- **DEBUG**: 詳細な内部処理情報

## 🔄 バージョン間の違い

### デスクトップ版 vs Web版
| 機能 | デスクトップ版 | Web版 |
|------|----------------|-------|
| パフォーマンス | 高速 | 中程度 |
| データサイズ | 大容量対応 | 制限あり |
| UI/UX | ネイティブ | ブラウザ依存 |
| インストール | 必要 | 不要 |
| オフライン利用 | 可能 | 不可 |

### エンジンバージョン
- **V1**: 高速、制約簡素化
- **V2**: 完全制約、Streamlit版準拠

## 💡 最適化のコツ

### 収益最大化のポイント
1. **価格予測精度**: より正確な予測データの使用
2. **損失率最小化**: 効率的なバッテリーシステム
3. **制約の適切な設定**: 過度に厳しい制約を避ける
4. **市場選択**: EPRX1/EPRX3の戦略的活用

### データ品質向上
1. **予測vs実績**: 予測精度の継続的改善
2. **欠損値対応**: 補間や除外の適切な判断
3. **異常値除去**: 明らかに不正な価格データの修正

---
**更新日**: 2024年最新版
**対象バージョン**: デスクトップ版 v2.0、Web版 v1.0 