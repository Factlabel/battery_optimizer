# Battery Optimizer Desktop App - 起動方法

## ワンクリック起動（推奨）

### macOS / Linux
```bash
./start_app.sh
```

## 手動起動

1. **仮想環境の作成とアクティベート**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # macOS/Linux
   # または
   venv\Scripts\activate  # Windows
   ```

2. **依存関係のインストール**
   ```bash
   pip install -r requirements.txt
   ```

3. **アプリケーションの起動**
   ```bash
   python main.py
   ```

## AI機能の使用方法

### 1. OpenAI API設定
- **設定ボタン（⚙️）**: 画面右上のボタンをクリック
- **AI設定タブ**: OpenAI APIキーを入力
- **接続テスト**: 「APIテスト」ボタンで接続確認

### 2. AI Chat機能
- **AI Chatタブ**: 最適化後に利用可能
- **文脈理解**: 最適化結果を理解した上でQ&A
- **分析レポート**: 収益性、リスク、改善提案を自動生成
- **送信データ確認**: AIに送信されるデータ内容を確認可能

### 3. Revenue Details
- **専用タブ**: 4種類の収益分析グラフ
  - **時間別収益**: 1時間ごとの収益分布
  - **市場別貢献**: JEPX、EPRX1、EPRX3の収益内訳
  - **アクション分布**: 充電・放電・待機の割合
  - **日別トレンド**: 日ごとの収益推移

### 4. 託送料金・損失率データ管理
- **データ表示**: 全エリア・全電圧区分の託送料金と損失率を表形式で表示
- **リアルタイム編集**: ダブルクリックで値を直接編集
- **再エネ賦課金設定**: 全国一律の再エネ賦課金単価を変更可能

## トラブルシューティング

### SoC（バッテリー残量）グラフが表示されない場合

1. **一般的な原因と解決法**
   - **原因**: 最適化が完了していない
     - **解決**: CSVデータを読み込んで「最適化実行」を完了させる
   
   - **原因**: 期間フィルターでデータが除外されている
     - **解決**: 「全期間」を選択して確認

### AI機能が利用できない場合

1. **APIキー設定確認**
   - ⚙️設定 → AI設定タブでAPIキーを設定
   - APIテストで接続を確認

2. **ネットワーク接続**
   - インターネット接続が必要
   - OpenAI APIへのアクセスを確認

### AI分析チャット「データがない」問題の解決法

**問題**: AIが「データを持っていない」「データがありません」と回答する

**解決手順**:

1. **送信データ確認ボタンを使用**
   - AI Chatタブで「📊 送信データ確認」をクリック
   - 3つのタブでデータ内容を確認

2. **最適化実行状況の確認**
   - 最適化が完了していることを確認
   - エラーで中断していないかチェック
   - 必要に応じて再実行

### GUI が表示されない場合

1. **macOS**
   - XQuartz がインストールされているか確認
   - `brew install --cask xquartz`

2. **Python バージョン確認**
   ```bash
   python3 --version
   # Python 3.8以上が推奨
   ```

## 使用方法

### 1. CSVデータの準備
- **必須列**: `date`, `slot`, `JEPX_prediction`, `JEPX_actual`, `EPRX1_actual`, `EPRX3_actual`, `imbalance`
- **サンプルデータ**: `test_clean_data.csv` (96行のクリーンデータ)
- **テンプレート**: 「テンプレートダウンロード」ボタンでサンプルを取得

### 2. 最適化の実行
1. バッテリー仕様を設定（出力・容量・損失率）
2. エリア・電圧区分を選択
3. CSVファイルを読み込み
4. 「最適化実行」ボタンをクリック
5. 進捗を確認してお待ちください

### 3. 結果の確認
- **Graphsタブ**: バッテリー残量推移とJEPX価格
- **Revenue Detailsタブ**: 詳細収益分析
- **Dataタブ**: 最適化結果の詳細データ
- **Summaryタブ**: 収益サマリー
- **AI Chatタブ**: AI分析とレポート 