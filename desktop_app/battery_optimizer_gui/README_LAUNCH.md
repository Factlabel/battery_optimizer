# Battery Optimizer Desktop App v2.1 - 起動方法

## 🚀 ワンクリック起動（推奨）

### macOS / Linux
```bash
./start_app.sh
```

### Windows
```cmd
start_app.bat  # (将来追加予定)
```

## 📋 手動起動

1. **仮想環境の作成とアクティベート**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # macOS/Linux
   # または
   venv\Scripts\activate  # Windows
   ```

2. **依存関係のインストール**
   ```bash
   pip install -r requirements.txt
   ```

3. **アプリケーションの起動**
   ```bash
   python main.py
   ```

## 🤖 NEW! AI機能の使用方法

### 1. OpenAI API設定
- **設定ボタン（⚙️）**: 画面右上のボタンをクリック
- **AI設定タブ**: OpenAI APIキーを入力
- **接続テスト**: 「APIテスト」ボタンで接続確認

### 2. AI Chat機能
- **AI Chatタブ**: 最適化後に利用可能
- **文脈理解**: 最適化結果を理解した上でQ&A
- **分析レポート**: 収益性、リスク、改善提案を自動生成

### 3. Revenue Details
- **専用タブ**: 4種類の収益分析グラフ
  - **時間別収益**: 1時間ごとの収益分布
  - **市場別貢献**: JEPX、EPRX1、EPRX3の収益内訳
  - **アクション分布**: 充電・放電・待機の割合
  - **日別トレンド**: 日ごとの収益推移

## 🔧 トラブルシューティング

### v2.1で修正された問題

#### ✅ データ検証エラー（修正済み）
- **問題**: `test_clean_data.csv`で「有効なデータが残りません」エラー
- **修正**: pandas自動検出を優先、変数未定義エラーを解決
- **対応**: `2023/4/1`形式の単桁月日に完全対応

#### ✅ 日付形式対応（修正済み）
- **サポート形式**: `2023/4/1`, `2023-04-01`, `4/1/2023` など
- **自動検出**: pandas による柔軟な日付変換
- **マルチエンコーディング**: UTF-8, Shift_JIS, CP932, EUC-JP

### 一般的なトラブルシューティング

#### SoC（バッテリー残量）グラフが表示されない場合

1. **ログを確認**
   - アプリの左下のログエリアでエラーメッセージを確認
   - ターミナルでデバッグ情報を確認

2. **一般的な原因と解決法**
   - **原因**: 最適化が完了していない
     - **解決**: CSVデータを読み込んで「最適化実行」を完了させる
   
   - **原因**: データに`battery_level_kWh`列がない
     - **解決**: 最新のコードで再度最適化を実行
   
   - **原因**: 期間フィルターでデータが除外されている
     - **解決**: 「全期間」を選択して確認

#### Revenue Detailsが表示されない場合

1. **OpenAI ライブラリ確認**
   ```bash
   pip install openai
   ```

2. **最適化完了確認**
   - Revenue Detailsは最適化完了後に利用可能
   - エラーがあればAI Chatで🐛問題報告を利用

#### AI機能が利用できない場合

1. **APIキー設定確認**
   - ⚙️設定 → AI設定タブでAPIキーを設定
   - APIテストで接続を確認

2. **ネットワーク接続**
   - インターネット接続が必要
   - OpenAI APIへのアクセスを確認

### GUI が表示されない場合

1. **macOS**
   - XQuartz がインストールされているか確認
   - `brew install --cask xquartz`

2. **Python バージョン確認**
   ```bash
   python3 --version
   # Python 3.8以上が推奨
   ```

3. **PyQt6 インストール確認**
   ```bash
   python -c "import PyQt6; print('PyQt6 OK')"
   ```

## 🎯 使用方法

### 1. CSVデータの準備
- **必須列**: `date`, `slot`, `JEPX_prediction`, `JEPX_actual`, `EPRX1_actual`, `EPRX3_actual`, `imbalance`
- **サンプルデータ**: `test_clean_data.csv` (96行のクリーンデータ)
- **テンプレート**: 「テンプレートダウンロード」ボタンでサンプルを取得

### 2. 最適化の実行
- **CSV読み込み**: 自動データ品質検証
- **パラメータ設定**: バッテリー容量、出力など
- **最適化実行**: フルモードで完全精度保証

### 3. 結果の確認
- **Graphsタブ**: バッテリー残量とJEPX価格（期間選択機能付き）
- **Revenue Detailsタブ**: 4種類の収益分析グラフ🆕
- **Dataタブ**: 詳細な最適化結果を表形式で表示
- **Summaryタブ**: 総利益や統計情報を表示
- **AI Chatタブ**: GPT-4oによる詳細分析🆕

## 🆕 v2.1新機能: 5タブインターフェース

### ⚙️ 統合設定
- **🤖 AI設定**: OpenAI APIキー管理
- **📧 メール設定**: 自動エラー報告用SMTP設定
- **⚙️ 一般**: ログレベル、自動保存設定

### 📊 Revenue Details（NEW!）
- **時間別収益**: バーチャート（1時間ごと）
- **市場別貢献**: パイチャート（JEPX/EPRX1/EPRX3）
- **アクション分布**: パイチャート（充電/放電/待機）
- **日別トレンド**: ラインチャート（利益・損失エリア）

### 🤖 AI Chat（NEW!）
- **コンテキスト分析**: 最適化結果を理解
- **質問応答**: 収益性、効率性、改善点について
- **🐛問題報告**: エラー自動報告機能

## 💡 ヒント

### データ処理
- **マルチエンコーディング**: 日本語CSVファイルも自動対応
- **データ品質**: 7段階の自動検証プロセス
- **大量データ**: 期間選択機能で特定期間にフォーカス

### 分析機能
- **AI分析**: 「なぜこの時間に充電したのか？」などの質問に回答
- **Revenue分析**: 市場別の収益構造を詳細分析
- **トレンド把握**: 日別収益推移で長期傾向を確認

### プロダクション利用
- **結果保存**: CSVエクスポートでレポート作成
- **エラー報告**: 自動メール報告で運用監視
- **設定保存**: パラメータ自動保存で効率運用

## 📞 サポート

### 自動エラー報告
v2.1では自動エラー報告機能を搭載。問題発生時は：
1. **🐛問題報告ボタン**: AI Chatタブ内
2. **自動収集**: システム情報、ログ、エラー詳細
3. **メール送信**: 管理者への自動通知

### 手動サポート
問題が発生した場合は、以下の情報と共にお問い合わせください：
- OS とバージョン
- Python バージョン  
- エラーメッセージ
- ログの内容（ターミナル出力）
- 使用中のCSVファイル名

---

**🏢 Factlabel** | © 2024 | **Battery Optimizer v2.1** 🤖 