# Battery Optimizer Desktop版 ユーザーマニュアル

## 📋 目次

1. [クイックスタート](#クイックスタート)
2. [機能概要](#機能概要) 
3. [詳細な使用方法](#詳細な使用方法)
4. [AIサポートデスクの使い方](#aiサポートデスクの使い方)
5. [トラブルシューティング](#トラブルシューティング)
6. [高度な設定](#高度な設定)

## クイックスタート

### 1. アプリケーションの起動
```bash
cd desktop_app/battery_optimizer_gui
python main.py
```

または、ダブルクリック起動:
```bash
./start_app.sh
```

### 2. 基本的な使用の流れ
1. **CSVファイルを読み込み**: 「CSVファイルを選択...」ボタンでデータをロード
2. **パラメータ設定**: バッテリー出力・容量・エリアなどを設定
3. **最適化実行**: 「最適化を実行」ボタンをクリック
4. **結果確認**: 各タブで結果を確認・分析

## 機能概要

### 🎯 主要タブ機能

#### 📊 グラフタブ
- **バッテリー残量推移**: 時系列でのSOC変化
- **JEPX価格推移**: 市場価格の変動
- **期間選択機能**: 全期間/最近7日/最近30日/期間指定
- **カレンダー選択**: 📅ボタンから直感的な日付選択

#### 💰 収益詳細タブ
- **時間別収益分布**: どの時間帯が最も収益性が高いか
- **市場別収益貢献**: JEPX vs EPRX1 vs EPRX3の貢献度
- **アクション分布**: 充電・放電・調整力の使用割合
- **日別収益推移**: 期間全体の収益トレンド

#### 📋 詳細データタブ
- **完全なトランザクションデータ**: 全スロットの最適化結果
- **CSVエクスポート機能**: 結果データの保存

#### 📄 サマリータブ
- **財務サマリー**: 総収益・コスト・利益の一覧
- **運用統計**: バッテリー利用状況・効率指標

#### 🤖 AI分析チャットタブ
- **インテリジェントな結果分析**: 自然言語でデータを質問
- **トラブルシューティング支援**: 技術的問題の解決策提案
- **よくある質問機能**: サンプル質問の表示

#### ⚡ 託送料金・損失率タブ
- **地域別料金設定**: 9エリア別の託送料金・損失率管理
- **リアルタイム編集**: 設定値の即座変更と保存

## 詳細な使用方法

### 📊 データ準備

#### CSVファイル形式
必要な列:
```csv
date,slot,JEPX_prediction,JEPX_actual,EPRX1_prediction,EPRX1_actual,EPRX3_prediction,EPRX3_actual,imbalance
2024-01-01,1,10.5,10.8,15.2,15.0,20.1,19.8,12.3
2024-01-01,2,11.2,11.5,16.1,15.8,21.0,20.5,13.1
```

#### データ品質チェックポイント
- ✅ **日付形式**: YYYY-MM-DD (ISO形式)
- ✅ **スロット**: 1-48の連続した値
- ✅ **価格データ**: 負の値も許可
- ✅ **欠損値**: 空白やNaNがないことを確認

### ⚙️ パラメータ設定ガイド

#### 基本パラメータ
| パラメータ | 説明 | 推奨値 |
|-----------|------|--------|
| エリア | 対象地域 (1-9) | 3 (東京) |
| 電圧 | 契約電圧種別 | HV (高圧) |
| バッテリー出力 | 最大充放電率 (kW) | 1000 |
| バッテリー容量 | 蓄電容量 (kWh) | 4000 |
| 損失率 | ラウンドトリップ効率 (%) | 5 |
| 初期残量 | 開始時SOC (kWh) | 2000 |

#### 高度なパラメータ
| パラメータ | 説明 | 推奨値 |
|-----------|------|--------|
| 日次サイクル制限 | 1日最大充電回数 | 1 |
| 予測対象スロット数 | 同時最適化スロット数 | 48-96 |
| EPRX1ブロックサイズ | 連続運用スロット数 | 4 |
| EPRX1クールダウン | ブロック間隔 | 4 |
| 1日最大EPRX1スロット | 日次EPRX1上限 | 6 |
| 年間サイクル制限 | 年間総充電回数 | 365 |

### 🚀 パフォーマンス最適化

#### エンジンバージョン選択
1. **V1 (高速モード)**: 
   - ✅ 用途: 日常業務・大規模データ
   - ✅ 特徴: EPRX1制約なし、最高速度
   - ✅ 推奨: 一般的な最適化業務

2. **V2 (標準モード)**:
   - ⚡ 用途: EPRX1も考慮したい場合
   - ⚡ 特徴: 簡易EPRX1制約
   - ⚡ 推奨: 中規模データ処理

3. **V2-full (完全モード)**:
   - 🔧 用途: Streamlit版との完全一致が必要
   - 🔧 特徴: 全制約条件を適用
   - 🔧 推奨: 小規模データ・検証用途

#### データサイズ別推奨設定
| データサイズ | エンジン | 予測スロット | 想定時間 |
|-------------|---------|-------------|----------|
| ~1,000スロット | V1 | 48 | 5-10秒 |
| ~5,000スロット | V1 | 48-96 | 30-60秒 |
| ~10,000スロット | V1 | 48 | 1-2分 |
| 10,000スロット超 | V1 | 48 | データ分割推奨 |

### 📈 結果分析ガイド

#### アクション種別の理解
- **charge**: 市場から充電 (JEPX価格が安い時間)
- **discharge**: 市場へ放電 (JEPX価格が高い時間)
- **eprx1**: 一次調整力ブロック運用
- **eprx3**: 三次調整力 (基本料金+インバランス調整)
- **idle**: 待機状態

#### 収益構造の理解
1. **JEPX収益**: 充放電による売買差益
2. **EPRX1収益**: 調整力容量提供による収益
3. **EPRX3収益**: 調整力基本料金+インバランス収益
4. **コスト**: 託送料金、再エネ賦課金、バッテリー損失

## AIサポートデスクの使い方

### 🤖 基本的な使用方法

#### 1. API設定
1. 右上の⚙️ボタンをクリック
2. 「OpenAI API」タブでAPIキーを設定
3. 「接続テスト」で動作確認

#### 2. 質問方法
1. **AI分析チャット**タブを開く
2. テキストボックスに質問を入力
3. 「送信」ボタンまたはEnterキーで送信

#### 3. サンプル質問
💡「よくある質問」ボタンから以下のような質問例を確認:

**データ分析系**:
- "最も収益の高い時間帯はいつですか？"
- "今回の最適化結果の総収益を教えてください"
- "EPRX1とEPRX3のどちらがより収益に貢献していますか？"

**トラブルシューティング系**:
- "アプリが起動しない場合の対処法を教えてください"
- "最適化が遅い場合の改善方法を教えてください"
- "CSVデータの正しい形式を教えてください"

### 🎯 効果的な質問のコツ

#### ✅ Good Examples
- "2024年1月15日の収益が他の日より高い理由を分析してください"
- "今回の最適化でEPRX1が使われなかった理由は何ですか？"
- "バッテリーの稼働率を向上させるにはどうすればよいですか？"

#### ❌ Avoid These
- "教えて" (具体性がない)
- "結果は？" (何の結果か不明)
- "よくない" (何が良くないか不明)

### 🔧 トラブルシューティング機能

#### 1. データ確認機能
「📊 送信データ確認」ボタンで、AIに送信されるデータ内容を事前確認可能

#### 2. 問題報告機能
「🐛 問題報告」ボタンで、アプリケーションの不具合を管理者に報告

#### 3. 自動診断
AIがナレッジベースを参照して、一般的な問題の解決策を自動提案

## トラブルシューティング

### 🚨 よくある問題と解決策

#### Q1: アプリケーションが起動しない
**症状**: ダブルクリックしてもアプリが開かない

**解決手順**:
1. **ターミナル起動確認**:
   ```bash
   cd desktop_app/battery_optimizer_gui
   python main.py
   ```

2. **依存関係確認**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Python版確認**:
   ```bash
   python --version  # 3.8以上が必要
   ```

#### Q2: CBCソルバーエラー
**症状**: "PULP_CBC_CMD: Not Available" エラー

**解決方法**:
1. **自動修復実行**:
   ```bash
   python setup.py
   ```

2. **Homebrewインストール（macOS）**:
   ```bash
   brew install cbc
   ```

3. **手動権限設定**:
   ```bash
   chmod +x .venv/lib/python*/site-packages/pulp/solverdir/cbc/*/cbc
   ```

#### Q3: 最適化が遅い・失敗する
**症状**: 計算が途中で止まる、異常に時間がかかる

**解決方法**:
1. **高速モード選択**: エンジンバージョンをV1に変更
2. **予測スロット削減**: 168 → 48-96に設定
3. **データサイズ確認**: 10,000スロット超は分割処理
4. **メモリ確認**: 他のアプリケーションを終了

#### Q4: CSVデータエラー
**症状**: "Invalid CSV format" エラー

**解決方法**:
1. **テンプレートダウンロード**: 「CSVテンプレートをダウンロード」使用
2. **列名確認**: 必須9列の存在確認
3. **日付形式**: YYYY-MM-DD形式に統一
4. **エンコーディング**: UTF-8で保存

#### Q5: グラフが表示されない
**症状**: 最適化後にグラフが空白

**解決方法**:
1. **日付範囲確認**: 期間指定モードで範囲が適切か確認
2. **データ確認**: ログパネルでフィルター結果を確認
3. **全期間表示**: まず「全期間」で表示を確認

### 🔍 ログの活用

#### ログパネルの見方
- **INFO**: 正常な処理状況
- **WARNING**: 注意が必要だが処理継続
- **ERROR**: 処理中断を引き起こす問題

#### 重要なログメッセージ
- `"フィルター後のデータが空"`: 期間設定を確認
- `"CBCソルバーエラー"`: ソルバー再インストール必要
- `"メモリ不足"`: データサイズを削減

## 高度な設定

### 💾 設定の保存と復元

#### 自動保存される設定
- ウィンドウサイズ・位置
- APIキー・メール設定
- 基本パラメータ値

#### 手動エクスポート
- CSVテンプレート
- 最適化結果
- グラフ画像

### 🌐 複数環境での使用

#### 設定ファイルの場所
- **macOS**: `~/Library/Preferences/`
- **Windows**: `HKEY_CURRENT_USER\Software\`
- **Linux**: `~/.config/`

#### 設定の移行
設定ダイアログの「設定をリセット」→「保存」で初期化可能

### 📊 詳細データの活用

#### エクスポート形式
- **CSV**: Excel・分析ツールで利用
- **JSON**: プログラム連携
- **画像**: レポート・プレゼンテーション

#### 外部ツール連携
- **Excel**: CSVインポートで詳細分析
- **Power BI**: データ可視化
- **Python/R**: プログラム分析

---

## 🆘 サポート情報

### 📞 サポート方法
1. **AIサポートデスク**: アプリ内チャット機能 (推奨)
2. **問題報告機能**: アプリ内「🐛 問題報告」ボタン
3. **ログファイル**: 詳細エラー情報を含む

### 📋 問題報告時の必要情報
- OS・Pythonバージョン
- エラーメッセージ全文
- 使用していたデータサイズ
- 実行手順

### 📚 追加リソース
- **ナレッジベース**: `AI_SUPPORT_KNOWLEDGE_BASE.md`
- **技術仕様**: `docs/README.md`
- **計算詳細**: `docs/calculation_overview.md`

---

**最終更新**: 2024年 v2.0対応
**対象バージョン**: Desktop版 v2.0 